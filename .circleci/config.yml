version: 2.1
orbs:
  docker: circleci/docker@2.2.0
jobs:
  build-and-push:
    executor: docker/docker
    docker:
      - image: cimg/base:stable
        name: docker login
        auth: 
          username: $DOCKER_USERNAME
          password: $DOCKER_PASSWORD
    steps:
      - setup_remote_docker
      - run:
          command: |
            echo $DOCKER_PASSWORD | docker login -u $DOCKER_USERNAME --password-stdin $DOCKER_PASSWORD
      - checkout
      - docker/check:
          docker-username: DOCKER_USERNAME
          docker-password: DOCKER_PASSWORD
      - docker/build:
          # image: dermsynth3d/v1
          image: sinashish/dermsynth3d
      - docker/push:
          digest-path: /tmp/digest.txt
          image: sinashish/dermsynth3d
      # - docker/publish:
      #     deploy: true
      #     image: dermsynth3d/v1
      - run:
          command: |
            echo "Digest is: $(</tmp/digest.txt)"
workflows:
  commit:
    jobs:
      - build-and-push
